<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychological Test - Competency Assessment</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .questionnaire {
            padding: 40px;
        }

        .question {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .question:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .question h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .option input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.2);
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            width: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .results h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }

        .distortion-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            width: 0%;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .questionnaire {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Psychological Test</h1>
            <p>Competency and Skills Assessment</p>
        </div>

        <div class="questionnaire">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <form id="questionnaireForm">
                <div class="question" data-question="1">
                    <h3>1. How do you describe yourself regarding your ability to work in a team?</h3>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q1" value="1" required>
                            <span>I have significant difficulties working in groups</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="2" required>
                            <span>I sometimes struggle to collaborate with others</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="3" required>
                            <span>I can work in a team, but with some limitations</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="4" required>
                            <span>I generally work well in teams and contribute positively</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q1" value="5" required>
                            <span>I am exceptionally effective in team-based work</span>
                        </label>
                    </div>
                </div>

                <div class="question" data-question="2">
                    <h3>2. How do you assess your ability to solve complex problems?</h3>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q2" value="1" required>
                            <span>I struggle to solve even simple problems</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q2" value="2" required>
                            <span>I can solve basic problems with effort</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q2" value="3" required>
                            <span>I solve problems of moderate complexity</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q2" value="4" required>
                            <span>I have good ability to solve complex problems</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q2" value="5" required>
                            <span>I am an expert at solving complex problems</span>
                        </label>
                    </div>
                </div>

                <div class="question" data-question="3">
                    <h3>3. How do you evaluate your communication skills?</h3>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q3" value="1" required>
                            <span>I have difficulty expressing myself clearly</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3" value="2" required>
                            <span>I sometimes have trouble conveying my ideas</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3" value="3" required>
                            <span>I communicate adequately in most situations</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3" value="4" required>
                            <span>I have good communication skills</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q3" value="5" required>
                            <span>I am an excellent communicator</span>
                        </label>
                    </div>
                </div>

                <div class="question" data-question="4">
                    <h3>4. How do you assess your leadership ability?</h3>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q4" value="1" required>
                            <span>I prefer not to take on leadership responsibilities</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q4" value="2" required>
                            <span>I can sometimes lead small groups</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q4" value="3" required>
                            <span>I can lead when necessary</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q4" value="4" required>
                            <span>I have good leadership ability</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q4" value="5" required>
                            <span>I am a natural and inspiring leader</span>
                        </label>
                    </div>
                </div>

                <div class="question" data-question="5">
                    <h3>5. How do you assess your adaptability to change?</h3>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q5" value="1" required>
                            <span>I have difficulty dealing with change</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q5" value="2" required>
                            <span>I sometimes adapt, but with resistance</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q5" value="3" required>
                            <span>I generally adapt well to change</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q5" value="4" required>
                            <span>I have good adaptability</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q5" value="5" required>
                            <span>I am very flexible and adapt quickly</span>
                        </label>
                    </div>
                </div>

                <div class="question" data-question="6">
                    <h3>6. How do you assess your organizational ability?</h3>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q6" value="1" required>
                            <span>I have difficulty staying organized</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q6" value="2" required>
                            <span>I can sometimes get organized</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q6" value="3" required>
                            <span>I am generally organized</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q6" value="4" required>
                            <span>I have good organizational skills</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q6" value="5" required>
                            <span>I am extremely organized and methodical</span>
                        </label>
                    </div>
                </div>

                <div class="question" data-question="7">
                    <h3>7. How do you assess your capacity for innovation?</h3>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q7" value="1" required>
                            <span>I prefer to follow traditional methods</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q7" value="2" required>
                            <span>I sometimes have creative ideas</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q7" value="3" required>
                            <span>I am generally creative in my solutions</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q7" value="4" required>
                            <span>I have good capacity for innovation</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q7" value="5" required>
                            <span>I am highly innovative and creative</span>
                        </label>
                    </div>
                </div>

                <div class="question" data-question="8">
                    <h3>8. How do you assess your negotiation skills?</h3>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q8" value="1" required>
                            <span>I have difficulty negotiating</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q8" value="2" required>
                            <span>I can sometimes reach agreements</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q8" value="3" required>
                            <span>I am generally good at negotiations</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q8" value="4" required>
                            <span>I have good negotiation skills</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q8" value="5" required>
                            <span>I am an excellent negotiator</span>
                        </label>
                    </div>
                </div>

                <div class="question" data-question="9">
                    <h3>9. How do you assess your time management skills?</h3>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q9" value="1" required>
                            <span>I have difficulty managing my time</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q9" value="2" required>
                            <span>I sometimes meet deadlines</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q9" value="3" required>
                            <span>I generally manage my time well</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q9" value="4" required>
                            <span>I have good time management skills</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q9" value="5" required>
                            <span>I am extremely efficient at time management</span>
                        </label>
                    </div>
                </div>

                <div class="question" data-question="10">
                    <h3>10. How do you assess your capacity for continuous learning?</h3>
                    <div class="options">
                        <label class="option">
                            <input type="radio" name="q10" value="1" required>
                            <span>I prefer not to learn new things</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q10" value="2" required>
                            <span>I sometimes try to learn something new</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q10" value="3" required>
                            <span>I generally seek to keep myself updated</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q10" value="4" required>
                            <span>I have a good capacity for continuous learning</span>
                        </label>
                        <label class="option">
                            <input type="radio" name="q10" value="5" required>
                            <span>I am an avid learner and always seek knowledge</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    Submit Answers
                </button>
            </form>

            <div id="results" class="results" style="display: none;">
                <h3>Assessment Results</h3>
                <div id="resultsContent"></div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        $(document).ready(function() {
            let answeredQuestions = 0;
            const totalQuestions = 10;

            // Update progress bar
            function updateProgress() {
                const progress = (answeredQuestions / totalQuestions) * 100;
                $('#progressFill').css('width', progress + '%');
            }

            // Mark selected option
            $('input[type="radio"]').change(function() {
                const question = $(this).closest('.question');
                question.find('.option').removeClass('selected');
                $(this).closest('.option').addClass('selected');

                // Count answered questions
                answeredQuestions = $('input[type="radio"]:checked').length;
                updateProgress();

                // Enable button only when all questions are answered
                if (answeredQuestions === totalQuestions) {
                    $('#submitBtn').prop('disabled', false);
                }
            });

            // Handle form submission
            $('#questionnaireForm').on('submit', function(e) {
                e.preventDefault();

                const answers = {};
                for (let i = 1; i <= totalQuestions; i++) {
                    const value = parseInt($(`input[name="q${i}"]:checked`).val());
                    answers[`q${i}`] = value;
                }

                const totalScore = Object.values(answers).reduce((acc, val) => acc + val, 0);
                const normalizedScore = totalScore / totalQuestions; // 1 to 5

                // Distortion detection and bidirectional correction
                const responses5 = Object.values(answers).filter(val => val === 5).length;
                const responses1 = Object.values(answers).filter(val => val === 1).length;

                // Dynamic threshold (70% of total questions)
                const threshold = Math.ceil(totalQuestions * 0.7);
                const maxAdjustment = 0.3; // up to 30%

                let correctedScore = normalizedScore;
                let distortionType = null; // 'high', 'low', or 'both'

                if (responses5 >= threshold) {
                    distortionType = 'high';
                    const distortionFactor = responses5 / totalQuestions;
                    const correctionFactor = 1 - (distortionFactor * maxAdjustment);
                    correctedScore = correctedScore * correctionFactor;
                }

                if (responses1 >= threshold) {
                    distortionType = distortionType ? 'both' : 'low';
                    const distortionFactor = responses1 / totalQuestions;
                    const boostFactor = 1 + (distortionFactor * maxAdjustment);
                    correctedScore = correctedScore * boostFactor;
                }

                // Ensure score stays within bounds
                correctedScore = Math.max(1.0001, Math.min(5, correctedScore));

                displayResults({
                    totalScore,
                    normalizedScore,
                    correctedScore,
                    responses5,
                    responses1,
                    threshold,
                    distortionType,
                    totalQuestions
                });
            });

            function displayResults(data) {
                const { totalScore, normalizedScore, correctedScore, responses5, responses1, threshold, distortionType, totalQuestions } = data;
                
                const maxScore = totalQuestions * 5;
                
                let html = `
                    <div class="result-item">
                        <strong>Total Score:</strong>
                        <span>${totalScore}/${maxScore}</span>
                    </div>
                    <div class="result-item">
                        <strong>Normalized Score (1-5):</strong>
                        <span>${normalizedScore.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <strong>Corrected Score:</strong>
                        <span>${correctedScore.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <strong>Responses with value 5:</strong>
                        <span>${responses5}/${totalQuestions}</span>
                    </div>
                    <div class="result-item">
                        <strong>Responses with value 1:</strong>
                        <span>${responses1}/${totalQuestions}</span>
                    </div>
                    <div class="result-item">
                        <strong>Distortion Threshold:</strong>
                        <span>${threshold} (70% of ${totalQuestions})</span>
                    </div>
                `;

                if (distortionType) {
                    if (distortionType === 'high') {
                        html += `
                            <div class="distortion-warning">
                                <strong>⚠️ Possible Distortion (Many 5s)</strong><br>
                                Pattern detected: ${responses5} responses with value 5 (≥ ${threshold} threshold).<br>
                                Score has been reduced to compensate for potential bias.
                            </div>
                        `;
                    } else if (distortionType === 'low') {
                        html += `
                            <div class="distortion-warning">
                                <strong>⚠️ Possible Distortion (Many 1s)</strong><br>
                                Pattern detected: ${responses1} responses with value 1 (≥ ${threshold} threshold).<br>
                                Score has been boosted to compensate for potential bias.
                            </div>
                        `;
                    } else if (distortionType === 'both') {
                        html += `
                            <div class="distortion-warning">
                                <strong>⚠️ Ambiguous Pattern</strong><br>
                                Many values 5 and 1 simultaneously. Manual review recommended.
                            </div>
                        `;
                    }
                }

                $('#resultsContent').html(html);
                $('#results').show();
                
                // Auto-export to Excel
                exportToExcel(data);
            }

            function exportToExcel(resultData) {
                const { totalScore, normalizedScore, correctedScore, responses5, responses1, threshold, distortionType, totalQuestions } = resultData;
                
                const maxScore = totalQuestions * 5;
                
                // Create Excel data
                const data = [
                    ['Psychological Test - Results'],
                    [''],
                    ['Date/Time', new Date().toLocaleString('en-US')],
                    [''],
                    ['Responses by Question:'],
                    ['Question', 'Response', 'Value'],
                ];

                // Add individual responses (we need to get them from the form)
                for (let i = 1; i <= totalQuestions; i++) {
                    const value = parseInt($(`input[name="q${i}"]:checked`).val());
                    data.push([`Question ${i}`, `Option ${value}`, value]);
                }

                data.push(['']);
                data.push(['RESULTS:']);
                data.push(['Total Score', `${totalScore}/${maxScore}`]);
                data.push(['Normalized Score (1-5)', normalizedScore.toFixed(2)]);
                data.push(['Corrected Score', correctedScore.toFixed(2)]);
                data.push(['Responses with value 5', `${responses5}/${totalQuestions}`]);
                data.push(['Responses with value 1', `${responses1}/${totalQuestions}`]);
                data.push(['Distortion Threshold', `${threshold} (70% of ${totalQuestions})`]);
                data.push(['Distortion Detected', distortionType || 'No']);
                
                if (distortionType === 'high') {
                    data.push(['Detected Pattern', 'Many 5s - Score reduced']);
                } else if (distortionType === 'low') {
                    data.push(['Detected Pattern', 'Many 1s - Score boosted']);
                } else if (distortionType === 'both') {
                    data.push(['Detected Pattern', 'Ambiguous - Manual review recommended']);
                }

                // Create workbook
                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Results');

                // Adjust column widths
                ws['!cols'] = [
                    { width: 28 },
                    { width: 26 },
                    { width: 16 }
                ];

                // Save file
                const fileName = `psychological_test_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.xlsx`;
                XLSX.writeFile(wb, fileName);

                alert(`Results exported to: ${fileName}`);
            }

            // Inicializar
            updateProgress();
            $('#submitBtn').prop('disabled', true);
        });
    </script>
</body>
</html>